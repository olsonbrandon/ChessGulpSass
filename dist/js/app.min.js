function Piece(t,i,o){this.row=t,this.col=i,this.color=o,this.img=null}function Rook(t,i,o){Piece.call(this,t,i,o);var e="white"===this.color?"2656":"265C";this.img=unicodeify(e)}function Bishop(t,i,o){Piece.call(this,t,i,o);var e="white"===this.color?"2657":"265D";this.img=unicodeify(e)}function Queen(t,i,o){Piece.call(this,t,i,o);var e="white"===this.color?"2655":"265B";this.img=unicodeify(e)}function Knight(t,i,o){Piece.call(this,t,i,o);var e="white"===this.color?"2658":"265E";this.img=unicodeify(e)}function Pawn(t,i,o,e){this.hasMoved=!1,this.dir=e,Piece.call(this,t,i,o);var n="white"===this.color?"2659":"265F";this.img=unicodeify(n)}function King(t,i,o){Piece.call(this,t,i,o);var e="white"===this.color?"2654":"265A";this.img=unicodeify(e)}function unicodeify(t){return String.fromCharCode(parseInt(t,16))}function canMoveTo(t,i){var o=getCell(t,i);return isOnBoard(t,i)&&(isEmpty(o)||isEnemy(t,i))}function isOnBoard(t,i){return t>=0&&t<=7&&i>=0&&i<=7}function isEmpty(t){return!t}function isEnemy(t,i){var o=getCell(t,i);return!isEmpty(o)&&currTurn!==o.color}function getCell(t,i){return isOnBoard(t,i)?board[t][i]:null}function deletePiece(t,i){board[t][i]=null}function allEnemies(){for(var t=[],i=0;i<8;i++)for(var o=0;o<8;o++)isEmpty(board[i][o])||board[i][o].color===currTurn||t.push(board[i][o]);return t}function getAllEnemiesTars(){for(var t=[],i=allEnemies(),o=0;o<i.length;o++){var e=i[o];t=t.concat(e.getTargets(!0))}return t}$(document).ready(function(){function t(){for(var t,o=0;o<8;o++){t=$('<div class="row">'),$("#board").append(t);for(var e,n,r=0;r<8;r++)e=(o+r)%2===0?"white":"silver",n=i(o,r,e),t.append(n)}}function i(t,i,o){var e=$('<div id="'+t.toString()+i.toString()+'">').addClass("cell").addClass(o);return t<2||t>5?e.html(board[t][i].img):e}function o(t){n();for(var i=0;i<t.length;i++)e(t[i])}function e(t){$("#"+t.x.toString()+t.y.toString()).addClass("highlight")}function n(){$(".highlight").removeClass("highlight"),$(".highlight-select").removeClass("highlight-select")}function r(t,i){$("#"+t+i).html(s.img),h(),currTurn="white"===currTurn?"black":"white"}function h(){$("#"+s.row+s.col).html("")}t();var s;$(".cell").click(function(){var t=$(this).attr("id"),i=board[t[0]][t[1]];if(i&&i.color===currTurn){s=i;var e=i.getTargets();o(e),$(this).addClass("highlight-select")}else $(this).hasClass("highlight")&&(n(),r(t[0],t[1]),s.moveTo(t[0],t[1]))})});var currTurn="white";Piece.prototype.moveTo=function(t,i){board[t][i]=this,deletePiece(this.row,this.col),this.row=Number(t),this.col=Number(i)},Rook.prototype=new Piece,Rook.prototype.getTargets=function(){for(var t=[],i=this.col-1;i>=0&&canMoveTo(this.row,i)&&(t.push({x:this.row,y:i}),!isEnemy(this.row,i));i--);for(var o=this.col+1;o<=7&&canMoveTo(this.row,o)&&(t.push({x:this.row,y:o}),!isEnemy(this.row,o));o++);for(var e=this.row-1;e>=0&&canMoveTo(e,this.col)&&(t.push({x:e,y:this.col}),!isEnemy(e,this.col));e--);for(var n=this.row+1;n<=7&&canMoveTo(n,this.col)&&(t.push({x:n,y:this.col}),!isEnemy(n,this.col));n++);return t},Bishop.prototype=new Piece,Bishop.prototype.getTargets=function(){for(var t=[],i={ul:!0,ur:!0,dl:!0,dr:!0},o=1;o<7;o++)i.ul&&canMoveTo(this.row-o,this.col-o)?(t.push({x:this.row-o,y:this.col-o}),isEnemy(this.row-o,this.col-o)&&(i.ul=!1)):i.ul=!1,i.ur&&canMoveTo(this.row-o,this.col+o)?(t.push({x:this.row-o,y:this.col+o}),isEnemy(this.row-o,this.col+o)&&(i.ur=!1)):i.ur=!1,i.dl&&canMoveTo(this.row+o,this.col-o)?(t.push({x:this.row+o,y:this.col-o}),isEnemy(this.row+o,this.col-o)&&(i.dl=!1)):i.dl=!1,i.dr&&canMoveTo(this.row+o,this.col+o)?(t.push({x:this.row+o,y:this.col+o}),isEnemy(this.row+o,this.col+o)&&(i.dr=!1)):i.dr=!1;return t},Queen.prototype=new Piece,Queen.prototype.getTargets=function(){var t=Bishop.prototype.getTargets.call(this),i=Rook.prototype.getTargets.call(this);return t.concat(i)},Knight.prototype=new Piece,Knight.prototype.getTargets=function(){for(var t,i=[],o=-2;o<=2;o++)0!==o&&(2===Math.abs(o)?t=1:1===Math.abs(o)&&(t=2),canMoveTo(this.row+o,this.col+t)&&i.push({x:this.row+o,y:this.col+t}),canMoveTo(this.row+o,this.col+t*-1)&&i.push({x:this.row+o,y:this.col+t*-1}));return i},Pawn.prototype=new Piece,Pawn.prototype.getTargets=function(t){var i=[],o="black"===this.color?1:-1,e=this.row+o,n=this.col;return!t&&isOnBoard(e,n)&&isEmpty(getCell(e,n))&&i.push({x:e,y:n}),!t&&!this.hasMoved&&isOnBoard(e+o,n)&&isEmpty(getCell(e+o,n))&&isEmpty(getCell(e,n))&&i.push({x:e+o,y:n}),(t||isEnemy(e,n+1))&&i.push({x:e,y:n+1}),(t||isEnemy(e,n-1))&&i.push({x:e,y:n-1}),i},Pawn.prototype.moveTo=function(t,i){Piece.prototype.moveTo.call(this,t,i),this.hasMoved=!0},King.prototype=new Piece,King.prototype.getTargets=function(){for(var t=[],i=-1;i<=1;i++)for(var o=-1;o<=1;o++)!canMoveTo(this.row+i,this.col+o)||this.color===currTurn&&this.willBeInCheck(this.row+i,this.col+o)||t.push({x:this.row+i,y:this.col+o});return t},King.prototype.willBeInCheck=function(t,i){for(var o=getAllEnemiesTars(),e=0;e<o.length;e++)if(o[e].x===t&&o[e].y===i)return!0;return!1};var board=[[new King(0,0,"black"),new Knight(0,1,"black"),new Bishop(0,2,"black"),new Queen(0,3,"black"),new King(0,4,"black"),new Bishop(0,5,"black"),new Knight(0,6,"black"),new Rook(0,7,"black")],[new Pawn(1,0,"black"),new Pawn(1,1,"black"),new Pawn(1,2,"black"),new Pawn(1,3,"black"),new Pawn(1,4,"black"),new Pawn(1,5,"black"),new Pawn(1,6,"black"),new Pawn(1,7,"black")],new Array(8),new Array(8),new Array(8),new Array(8),[new Pawn(6,0,"white"),new Pawn(6,1,"white"),new Pawn(6,2,"white"),new Pawn(6,3,"white"),new Pawn(6,4,"white"),new Pawn(6,5,"white"),new Pawn(6,6,"white"),new Pawn(6,7,"white")],[new Rook(7,0,"white"),new Knight(7,1,"white"),new Bishop(7,2,"white"),new Queen(7,3,"white"),new King(7,4,"white"),new Bishop(7,5,"white"),new Knight(7,6,"white"),new Rook(7,7,"white")]];